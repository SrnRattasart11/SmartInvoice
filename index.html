<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Smart Invoice ‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏≥‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ ‡πÉ‡∏ö‡∏ß‡∏≤‡∏á‡∏ö‡∏¥‡∏• ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÉ‡∏™‡πà‡πÇ‡∏•‡πÇ‡∏Å‡πâ/QR PromptPay ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì VAT ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏õ‡πá‡∏ô PDF ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢">
    <title>Smart Invoice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; color: #333; }
        
        @media print {
            .no-print { display: none !important; }
            body { background-color: white; padding: 0; }
            .invoice-box { border: none !important; box-shadow: none !important; margin: 0 !important; width: 100% !important; padding: 10px !important; }
            textarea, input, select { border: none !important; background: transparent !important; resize: none !important; -webkit-appearance: none; appearance: none; }
            .logo-upload-area, .qr-item-area { border: none !important; }
            .doc-info-box, .total-blue-box, #invoice-title { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }

        .invoice-box {
            max-width: 1000px;
            margin: 20px auto;
            background: white;
            padding: 45px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.1);
            border-radius: 4px;
        }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏à‡∏≤‡∏Å index.html --- */
        .flexible-address {
            width: 100%; resize: none; overflow: hidden; line-height: 1.4;
            max-height: 2.8em; font-size: 13px; border-bottom: 1px dashed #cbd5e1; background: transparent;
        }
        .flexible-address:focus { outline: none; border-bottom: 1px solid #3b82f6; }

        input, select { border-bottom: 1px dashed #cbd5e1; padding: 1px 4px; font-size: 13px; background: transparent; }
        input:focus, select:focus { outline: none; border-bottom: 1px solid #3b82f6; }

        .doc-info-box { background-color: #eef6ff; padding: 20px 15px; border-radius: 6px; width: 320px; position: relative; transition: background-color 0.3s; }
        .box-color-tool { position: absolute; top: 5px; right: 5px; opacity: 0; transition: opacity 0.2s; z-index: 20; }
        .doc-info-box:hover .box-color-tool { opacity: 1; }

        .title-container { position: relative; display: inline-block; }
        .title-color-tool { position: absolute; top: -5px; left: -30px; opacity: 0; transition: opacity 0.2s; }
        .title-container:hover .title-color-tool { opacity: 1; }

        .info-row { position: relative; padding-right: 40px; }
        .info-tools { position: absolute; right: 0; top: 50%; transform: translateY(-50%); display: flex; gap: 2px; opacity: 0; transition: opacity 0.2s; }
        .info-row:hover .info-tools { opacity: 1; }

        /* --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å index.html --- */
        .number-cell { position: relative; width: 50px; text-align: center; }
        .tools-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; gap: 4px; background-color: white; opacity: 0; transition: opacity 0.2s; z-index: 10; }
        .number-cell:hover .tools-container { opacity: 1; }

        .btn-tool { width: 18px; height: 18px; border-radius: 4px; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 11px; }
        .btn-add { background-color: #10b981; }
        .btn-sub { background-color: #ef4444; }

        .total-blue-box {background-color: #eef6ff; border-radius: 6px; padding: 12px 15px; margin: 10px 0; position: relative; }


        /* ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô) */
        .total-number-color-tool{
            position: absolute;
            top: 6px;
            right: 6px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 20;
        }
        .total-blue-box:hover .total-number-color-tool{
            opacity: 1;
        }



        .logo-upload-area { width: 180px; min-height: 60px; border: 1px dashed #e2e8f0; display: flex; flex-direction: column; justify-content: center; padding: 10px; margin-bottom: 15px; position: relative; }
        #company-logo { max-height: 60px; display: none; margin-bottom: 10px; object-fit: contain; }
        .btn-remove-logo { position: absolute; top: -10px; right: -10px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: none; align-items: center; justify-content: center; cursor: pointer; }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å index2.html --- */
        .payment-item { position: relative; }
        .row-tools-payment { position: absolute; right: -25px; top: 50%; transform: translateY(-50%); display: flex; gap: 2px; opacity: 0; transition: opacity 0.2s; }
        .payment-item:hover .row-tools-payment { opacity: 1; }
        /* --- ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà: Layout ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á) --- */
        .payment-item { position: relative; }
        .row-tools-payment { position: absolute; right: -25px; top: 50%; transform: translateY(-50%); display: flex; gap: 2px; opacity: 0; transition: opacity 0.2s; }
        .payment-item:hover .row-tools-payment { opacity: 1; }

        /* QR ‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö block ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤) */
        .qr-item-area{
            width: 120px;
            height: 120px;
            border: 1px dashed #cbd5e1;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
            cursor: pointer;
            display: flex;
            flex: 0 0 auto;
        }
        .qr-body{ padding: 10px; width: 100%; height: 100%; display: flex; }
        .qr-box{
            width: 100%;
            height: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #fff;
        }
        .qr-placeholder{ font-size: 10px; color: #94a3b8; }
        .qr-preview-img{ width: 100%; height: 100%; object-fit: contain; display: none; }

        .bank-logo{ width: 44px; height: 44px; object-fit: contain; }
        .bank-select{
            width: 100%;
            font-size: 13px;
            font-weight: 700;
            color: #1d4ed8;
            border-bottom: 1px dotted #93c5fd;
            padding: 2px 0 4px 0;
        }
        .payment-input{
            width: 100%;
            font-size: 12px;
            border-bottom: 1px dotted #cbd5e1;
            padding: 2px 0 4px 0;
        }

    </style>
</head>
<body class="p-4">

    <div class="no-print max-w-[1000px] mx-auto mb-4 flex justify-between items-center bg-slate-800 text-white p-3 rounded shadow-md">
        <span class="text-sm">‚≠ê <b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> Version 0.0.1</span>
        <button onclick="window.print()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-1.5 rounded font-bold shadow-lg transition-all">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ (PDF)</button>
    </div>

    <div class="invoice-box">
        <div class="flex gap-10">
            <div class="flex-1">
                <div class="border-b-2 border-black pb-6 mb-6">
                    <div class="logo-upload-area no-print" id="logo-container">
                        <div id="btn-remove-logo" class="btn-remove-logo" onclick="removeLogo()">√ó</div>
                        <img id="company-logo" src="" alt="Logo">
                        <input type="file" id="logo-input" accept="image/*" onchange="loadLogo(event)" class="text-[10px] w-full">
                    </div>
                    <div class="hidden print:block mb-4"><img id="print-logo" style="max-height: 60px; display:none;"></div>

                    <div class="grid grid-cols-[80px_1fr_180px] gap-x-4 gap-y-2 text-[13px]">
                        <span class="font-bold">‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ :</span>
                        <input type="text" value="‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏à‡∏≥‡∏Å‡∏±‡∏î" class="font-bold text-sm">
                        <div class="row-span-3 text-[12px] space-y-1 border-l pl-4 border-slate-100">
                            <div class="flex items-center gap-1">üìû <input type="text" value="02-XXX-XXXX" class="w-full"></div>
                            <div class="flex items-center gap-1">‚úâÔ∏è <input type="text" value="contact@company.com" class="w-full"></div>
                            <div class="flex items-center gap-1">üåê <input type="text" value="www.company.com" class="w-full"></div>
                        </div>
                        <span class="font-bold">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà :</span>
                        <textarea class="flexible-address" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢..."></textarea>
                        <span class="font-bold">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏©‡∏µ :</span>
                        <input type="text" value="0XXXXXXXXXXXX">
                    </div>
                </div>

                <div class="grid grid-cols-[80px_1fr_180px] gap-x-4 gap-y-2 text-[13px] items-start">
                    <span class="font-bold">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ :</span>
                    <input type="text" value="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" class="font-bold text-sm">
                    <div class="row-span-3 text-[12px] space-y-1 border-l pl-4 border-slate-100">
                        <div class="flex items-center gap-1">üìû <input type="text" value="08X-XXX-XXXX" class="w-full"></div>
                        <div class="flex items-center gap-1">‚úâÔ∏è <input type="text" value="customer@email.com" class="w-full"></div>
                        <div class="flex items-center gap-1">üåê <input type="text" value="-" class="w-full"></div>
                    </div>
                    <span class="font-bold">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà :</span>
                    <textarea class="flexible-address" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..."></textarea>
                    <span class="font-bold">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏©‡∏µ :</span>
                    <input type="text" value="-">
                    <span class="font-bold italic">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô :</span>
                    <input type="text" value="‡∏Ñ‡∏∏‡∏ì‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤" class="w-full">
                </div>
            </div>

            <div class="w-[320px] flex flex-col items-end">
                <div class="title-container mb-6">
                    <div class="title-color-tool no-print">
                        <input type="color" value="#2563eb" onchange="updateTitleColor(this.value)" class="w-6 h-6 cursor-pointer border-none bg-transparent">
                    </div>
                    <h2 id="invoice-title" class="text-2xl font-bold text-blue-600 italic">
                        ‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ <span class="text-[10px] not-italic text-slate-400">(‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö)</span>
                    </h2>
                </div>
                
                <div id="doc-info-container" class="doc-info-box space-y-2">
                    <div class="box-color-tool no-print" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á">
                        <input type="color" value="#eef6ff" onchange="updateBoxColor(this.value)" class="w-6 h-6 cursor-pointer border-none bg-transparent">
                    </div>

                    <div class="info-row flex justify-between items-center">
                        <select class="w-[110px] font-medium"><option value="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£" selected>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ :</option><option>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å :</option><option>‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï :</option><option>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î :</option><option>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á :</option></select>
                        <input type="text" value="IVT-20260117" class="w-32 text-right font-bold">
                        <div class="info-tools no-print"><div class="btn-tool btn-add" onclick="addDocInfoRow(this)">+</div><div class="btn-tool btn-sub" onclick="removeDocInfoRow(this)">-</div></div>
                    </div>
                    <div class="info-row flex justify-between items-center">
                        <select class="w-[110px] font-medium"><option>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å :</option></select>
                        <input type="text" value="17/01/2026" class="w-32 text-right">
                    </div>
                    <div class="info-row flex justify-between items-center">
                        <select class="w-[110px] font-medium"><option>‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï :</option></select>
                        <input type="text" value="30 ‡∏ß‡∏±‡∏ô" class="w-32 text-right">
                    </div>
                    <div class="info-row flex justify-between items-center">
                        <select class="w-[110px] font-medium"><option>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î :</option></select>
                        <input type="text" value="16/02/2026" class="w-32 text-right">
                    </div>
                    <div class="info-row flex justify-between items-center">
                        <select class="w-[110px] font-medium"><option>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á :</option></select>
                        <input type="text" value="-" class="w-32 text-right">
                    </div>
                </div>
            </div>
        </div>

        <table class="w-full mt-10 mb-8 text-[13px]">
            <thead class="bg-slate-50 border-y border-slate-200">
                <tr class="text-left text-slate-500 font-bold">
                    <th class="py-2 text-center w-12">#</th>
                    <th class="py-2 px-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th>
                    <th class="py-2 text-right w-24">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                    <th class="py-2 text-right w-32">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                    <th class="py-2 text-right w-32">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</th>
                </tr>
            </thead>
            <tbody id="invoice-items">
                <tr class="border-b border-slate-50">
                    <td class="number-cell py-4">
                        <span class="row-index text-slate-300">1</span>
                        <div class="tools-container no-print">
                            <div class="btn-tool btn-add" onclick="addRow(this)">+</div>
                            <div class="btn-tool btn-sub" onclick="removeRow(this)">-</div>
                        </div>
                    </td>
                    <td class="py-4 px-4"><input type="text" value="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." class="w-full font-bold text-slate-700"></td>
                    <td class="py-4 text-right"><input type="number" value="1" class="qty w-full text-right" oninput="calculate()"></td>
                    <td class="py-4 text-right"><input type="number" value="0" class="price w-full text-right" oninput="calculate()"></td>
                    <td class="py-4 text-right total-row font-bold text-slate-700">0.00</td>
                </tr>
            </tbody>
        </table>

        <div class="flex justify-between items-start pt-6 border-t-2 border-slate-200">
            <div class="space-y-2 text-[12px] text-slate-600">
                <div class="flex gap-4"><span>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ 7% :</span> <span id="sub-total">0.00 ‡∏ö‡∏≤‡∏ó</span></div>
                <div class="flex gap-4 pb-1"><span>‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7% :</span> <span id="vat-amount">0.00 ‡∏ö‡∏≤‡∏ó</span></div>
                <div class="text-slate-800 border-t border-slate-100 pt-3">
                    <p class="font-bold flex items-center gap-2 mb-1"><span class="no-print">üìù</span> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</p>
                    <p id="thai-baht-text" class="italic text-slate-500 text-sm">(‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô)</p>
                </div>
            </div>

            <div class="w-96 space-y-3 text-[12px]">
                <div id="total-box" class="total-blue-box flex justify-between items-center shadow-sm">
                    <div class="total-number-color-tool no-print" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô">
                        <input type="color" value="#1d4ed8" onchange="updateTotalNumberColor(this.value)"
                               class="w-6 h-6 cursor-pointer border-none bg-transparent">
                    </div>
                    <span class="font-bold text-slate-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span>
                    <div class="text-right"><span id="total-amount-box" class="text-xl font-bold text-blue-700">0.00</span> <span class="ml-1 font-bold text-blue-700">‡∏ö‡∏≤‡∏ó</span></div>
                </div>
                <div class="px-2 space-y-2">
                    <div class="flex justify-between items-center text-slate-600">
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="enable-wht" onchange="calculate()" class="no-print cursor-pointer">
                            <span class="font-medium">‡∏´‡∏±‡∏Å‡∏†‡∏≤‡∏©‡∏µ ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢ :</span>
                            <select id="wht-rate" onchange="calculate()" class="no-print bg-white border border-slate-200 rounded px-1 text-[11px]">
                                <option value="1">1%</option><option value="3" selected>3%</option><option value="5">5%</option>
                            </select>
                        </div>
                        <span id="wht-amount-display" class="font-medium text-slate-500">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <div class="flex justify-between font-bold text-slate-900 text-sm border-t border-slate-900 pt-2 mt-1">
                        <span>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô :</span><span id="net-payable" class="text-base">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-10 mt-10 border-t-2 border-black pt-6">
            <div>
                <p class="text-[13px] font-bold mb-4 flex justify-between items-center">
                    üè¶ ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô 
                    <button onclick="addBankRow()" class="no-print bg-blue-500 text-white px-2 py-0.5 rounded text-[10px]">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                </p>
                <div id="payment-container" class="space-y-4">
                    </div>
            </div>

            <div class="space-y-6">
                <div class="text-[12px] border-b pb-2">
                    <span class="font-bold">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span>
                    <textarea class="w-full h-10 text-[11px] mt-1" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div class="space-y-2">
                        <div class="border border-dashed border-slate-300 h-20 flex items-center justify-center text-[10px] text-slate-300 italic">‡∏ï‡∏£‡∏≤‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö</div>
                        <div class="border-b border-black w-36 mx-auto"></div>
                        <div class="text-[11px] flex justify-center items-center gap-1">( <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ã‡πá‡∏ô" class="w-32 text-center"> )</div>
                        <p class="text-[11px] font-bold">‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢)</p>
                        <p class="text-[9px]">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="text" class="w-20 text-center"></p>
                    </div>
                    <div class="space-y-2">
                        <div class="border border-dashed border-slate-300 h-20 flex items-center justify-center text-[10px] text-slate-300 italic">‡∏ï‡∏£‡∏≤‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö</div>
                        <div class="border-b border-black w-36 mx-auto"></div>
                        <div class="text-[11px] flex justify-center items-center gap-1">( <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" class="w-32 text-center"> )</div>
                        <p class="text-[11px] font-bold">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)</p>
                        <p class="text-[9px]">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="text" class="w-20 text-center"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const banks = [
            {code:"SCB", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå", logo:"https://drive.google.com/thumbnail?id=1QuQ6YyILEkzJPSDO8SANtz1jZb7MO0_t&sz=w200"},
            {code:"BBL", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û", logo:"https://drive.google.com/thumbnail?id=1V2O09GwYrzseMjHEiCjoJB4byIkwfy84&sz=w200"},
            {code:"KTB", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢", logo:"https://drive.google.com/thumbnail?id=1vOhRUMTr87hSXEzqfr3bOa2TBCToUyin&sz=w200"},
            {code:"BAY", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", logo:"https://drive.google.com/thumbnail?id=1-Urf9z6IRmg6un4Z-d_x-_4dqtm9Bnca&sz=w200"},
            {code:"TTB", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏´‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ò‡∏ô‡∏ä‡∏≤‡∏ï", logo:"https://drive.google.com/thumbnail?id=19bNFDYGxYs_PWRuzxkTXrbz5DjS6qgyX&sz=w200"},
            {code:"UOBT", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏¢‡∏π‡πÇ‡∏≠‡∏ö‡∏µ", logo:"https://drive.google.com/thumbnail?id=15a3n6JCg69pCyXE6m-aS3U9CtH0rSsA3&sz=w200"},
            {code:"GSB", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô", logo:"https://drive.google.com/thumbnail?id=1K2TwNVK6fTCUnQieim62KhffeyuvEZIu&sz=w200"},
            {code:"KKP", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ô‡∏≤‡∏Ñ‡∏¥‡∏ô‡∏†‡∏±‡∏ó‡∏£", logo:"https://drive.google.com/thumbnail?id=1HZjI25DmUjUkmw77qDS6vZwbBivflJcD&sz=w200"},
            {code:"TISCO", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏¥‡∏™‡πÇ‡∏Å‡πâ", logo:"https://drive.google.com/thumbnail?id=14BRIb3ZuQA4OedUnl48EayGGq0H1tu6F&sz=w200"},
            {code:"BAAC", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Ø", logo:"https://drive.google.com/thumbnail?id=1ZAbVPWWCFGrN3IIucLMqQhs_mKoKPLYE&sz=w200"},
            {code:"ICBC", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏≠‡∏ã‡∏µ‡∏ö‡∏µ‡∏ã‡∏µ (‡πÑ‡∏ó‡∏¢)", logo:"https://drive.google.com/thumbnail?id=1dQG4b7xTrYdOXyMF7FlFXAn_2MGX9K4E&sz=w200"},
            {code:"BOC", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏à‡∏µ‡∏ô (‡πÑ‡∏ó‡∏¢)", logo:"https://drive.google.com/thumbnail?id=1MEHLTNuw6tgAyiwJafniFPYNC2wxWrEJ&sz=w200"},
            {code:"ISBT", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏¥‡∏™‡∏•‡∏≤‡∏°‡πÅ‡∏´‡πà‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢", logo:"https://drive.google.com/thumbnail?id=15gJ51eDb3iVC5MQcONh-Y1IaeiIc5o6-&sz=w200"},
            {code:"GHB", name:"‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", logo:"https://drive.google.com/thumbnail?id=1kc4YQCkhkGhA3qhHDDWBUUyprxE_CfZc&sz=w200"},
            {code:"TRUEMONEY", name:"‡∏ó‡∏£‡∏π‡∏°‡∏±‡∏ô‡∏ô‡∏µ‡πà", logo:"https://drive.google.com/thumbnail?id=1PzxF4egVTrJePAvg-phvavQgFZQ_8nXG&sz=w200"}
        ];

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Header & Logo (index.html) ---
        function updateBoxColor(color) {
            // Sync background color between Document Info box and Total Amount box
            document.getElementById('doc-info-container').style.backgroundColor = color;
            document.querySelectorAll('.total-blue-box').forEach(el => {
                el.style.backgroundColor = color;
            });
        }
        function updateTitleColor(color) { document.getElementById('invoice-title').style.color = color; }

        function loadLogo(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = f => {
                    document.getElementById('company-logo').src = f.target.result;
                    document.getElementById('company-logo').style.display = 'block';
                    document.getElementById('print-logo').src = f.target.result;
                    document.getElementById('print-logo').style.display = 'block';
                    document.getElementById('btn-remove-logo').style.display = 'flex';
                    document.getElementById('logo-input').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }
        function removeLogo() {
            document.getElementById('company-logo').style.display = 'none';
            document.getElementById('print-logo').style.display = 'none';
            document.getElementById('btn-remove-logo').style.display = 'none';
            document.getElementById('logo-input').style.display = 'block';
            document.getElementById('logo-input').value = "";
        }

        function addDocInfoRow(btn) {
            const currentRow = btn.closest('.info-row');
            const newRow = document.createElement('div');
            newRow.className = 'info-row flex justify-between items-center';
            newRow.innerHTML = `<select class="w-[110px] font-medium"><option>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ :</option><option>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å :</option><option>‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï :</option><option>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î :</option><option selected>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á :</option></select><input type="text" placeholder="..." class="w-32 text-right"><div class="info-tools no-print"><div class="btn-tool btn-add" onclick="addDocInfoRow(this)">+</div><div class="btn-tool btn-sub" onclick="removeDocInfoRow(this)">-</div></div>`;
            currentRow.parentNode.insertBefore(newRow, currentRow.nextSibling);
        }
        function removeDocInfoRow(btn) { if (document.querySelectorAll('.info-row').length > 1) { btn.closest('.info-row').remove(); } }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (index.html) ---
        function addRow(btn) {
            const currentRow = btn.closest('tr');
            const newRow = document.createElement('tr');
            newRow.className = 'border-b border-slate-50';
            newRow.innerHTML = `<td class="number-cell py-4"><span class="row-index text-slate-300"></span><div class="tools-container no-print"><div class="btn-tool btn-add" onclick="addRow(this)">+</div><div class="btn-tool btn-sub" onclick="removeRow(this)">-</div></div></td><td class="py-4 px-4"><input type="text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..." class="w-full font-bold text-slate-700"></td><td class="py-4 text-right"><input type="number" value="1" class="qty w-full text-right" oninput="calculate()"></td><td class="py-4 text-right"><input type="number" value="0" class="price w-full text-right" oninput="calculate()"></td><td class="py-4 text-right total-row font-bold text-slate-700">0.00</td>`;
            currentRow.parentNode.insertBefore(newRow, currentRow.nextSibling);
            updateIndices(); calculate();
        }
        function removeRow(btn) { if (document.querySelectorAll('#invoice-items tr').length > 1) { btn.closest('tr').remove(); updateIndices(); calculate(); } }
        function updateIndices() { document.querySelectorAll('.row-index').forEach((span, i) => { span.innerText = i + 1; }); }

        function calculate() {
            let subTotal = 0;
            document.querySelectorAll('#invoice-items tr').forEach(row => {
                const qty = parseFloat(row.querySelector('.qty').value) || 0;
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const total = qty * price;
                row.querySelector('.total-row').innerText = total.toLocaleString(undefined, {minimumFractionDigits: 2});
                subTotal += total;
            });
            const vat = subTotal * 0.07;
            const totalAmount = subTotal + vat;
            let whtAmount = 0;
            if (document.getElementById('enable-wht').checked) {
                const rate = parseFloat(document.getElementById('wht-rate').value) || 0;
                whtAmount = subTotal * (rate / 100);
            }
            const netPayable = totalAmount - whtAmount;

            document.getElementById('sub-total').innerText = subTotal.toLocaleString(undefined, {minimumFractionDigits: 2}) + " ‡∏ö‡∏≤‡∏ó";
            document.getElementById('vat-amount').innerText = vat.toLocaleString(undefined, {minimumFractionDigits: 2}) + " ‡∏ö‡∏≤‡∏ó";
            document.getElementById('total-amount-box').innerText = totalAmount.toLocaleString(undefined, {minimumFractionDigits: 2});
            document.getElementById('thai-baht-text').innerText = "(" + ArabicToThaiBaht(totalAmount) + ")";
            document.getElementById('wht-amount-display').innerText = (whtAmount > 0 ? "- " : "") + whtAmount.toLocaleString(undefined, {minimumFractionDigits: 2}) + " ‡∏ö‡∏≤‡∏ó";
            document.getElementById('net-payable').innerText = netPayable.toLocaleString(undefined, {minimumFractionDigits: 2}) + " ‡∏ö‡∏≤‡∏ó";
        }

        function ArabicToThaiBaht(n) {
            if (n === 0) return "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";
            let s = n.toFixed(2).split("."), b = s[0], st = s[1], out = NumberToThaiWords(b) + "‡∏ö‡∏≤‡∏ó" + (st === "00" ? "‡∏ñ‡πâ‡∏ß‡∏ô" : NumberToThaiWords(st) + "‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå");
            return out;
        }
        function NumberToThaiWords(n) {
            const d = ["‡∏®‡∏π‡∏ô‡∏¢‡πå","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤"], u = ["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];
            let out = ""; for(let i=0; i<n.length; i++){
                let dig = parseInt(n[i]), pos = n.length-i-1;
                if(dig!==0){
                    if(pos%6===1 && dig===1) out += "";
                    else if(pos%6===1 && dig===2) out += "‡∏¢‡∏µ‡πà";
                    else if(pos%6===0 && dig===1 && i>0) out += "‡πÄ‡∏≠‡πá‡∏î";
                    else out += d[dig];
                    out += u[pos % 6];
                }
                if(pos%6===0 && pos>0) out += u[6];
            } return out;
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏° QR ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (index2.html) ---
        function addBankRow() {
            const container = document.getElementById('payment-container');
            const div = document.createElement('div');
            div.className = "payment-item flex items-stretch gap-6 p-2 rounded hover:bg-slate-50";

            let opt = banks.map(b => `<option value="${b.code}">${b.name}</option>`).join('');

            div.innerHTML = `
                <div class="qr-item-area" onclick="this.querySelector('input').click()">
                    <div class="qr-body">
                        <div class="qr-box">
                            <span class="qr-placeholder">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° QR</span>
                            <img class="qr-preview-img" alt="QR Preview">
                        </div>
                        <input type="file" accept="image/*" style="display:none" onchange="loadItemQR(event, this)">
                    </div>
                </div>


                <div class="flex items-start gap-3 flex-1 bank-detail">
                    <img src="${banks[0].logo}" class="bank-logo" alt="Bank logo">
                    <div class="flex-1">
                        <select onchange="updateBank(this)" class="no-print bank-select bg-transparent">
                            ${opt}
                        </select>
                        <span class="hidden print:block font-bold text-blue-800 text-[13px]">${banks[0].name}</span>

                        <div class="mt-3 space-y-2">
                            <input type="text" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" class="payment-input bg-transparent">
                            <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" class="payment-input bg-transparent">
                        </div>
                    </div>
                </div>

                <div class="row-tools-payment no-print">
                    <div class="btn-tool btn-sub" onclick="this.closest('.payment-item').remove()">-</div>
                </div>
            `;

            container.appendChild(div);
            requestAnimationFrame(() => syncQrSizeForRow(div));
        }
        function updateBank(sel) {
            const b = banks.find(x => x.code === sel.value);
            const parent = sel.closest('.payment-item');
            parent.querySelector('.bank-logo').src = b.logo;
            parent.querySelector('span.print\:block').innerText = b.name;
        }
        function fileToDataURL(file){
            return new Promise((resolve, reject) => {
                const r = new FileReader();
                r.onload = () => resolve(r.result);
                r.onerror = reject;
                r.readAsDataURL(file);
            });
        }

        function syncQrSizeForRow(paymentItem){
            const detail = paymentItem.querySelector('.bank-detail');
            const qrArea = paymentItem.querySelector('.qr-item-area');
            if(!detail || !qrArea) return;
            const h = Math.ceil(detail.getBoundingClientRect().height);
            // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™ ‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
            const size = Math.max(90, Math.min(h, 150));
            qrArea.style.width = size + 'px';
            qrArea.style.height = size + 'px';
        }
        function syncAllQrSizes(){
            document.querySelectorAll('.payment-item').forEach(syncQrSizeForRow);
        }

        async function loadItemQR(e, input) {
            const file = e.target.files && e.target.files[0];
            if (!file) return;

            const card = input.closest('.payment-item');
            const qrArea = card.querySelector('.qr-item-area');
            const qrBox = qrArea.querySelector('.qr-box');
            const preview = qrBox.querySelector('.qr-preview-img');
            const placeholder = qrBox.querySelector('.qr-placeholder');

            // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏° (‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö QR ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
            let outUrl = await fileToDataURL(file);

            // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ï‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô QR ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏ô Chrome/Edge ‡∏ú‡πà‡∏≤‡∏ô BarcodeDetector)
            try{
                if ('BarcodeDetector' in window) {
                    const detector = new BarcodeDetector({ formats: ['qr_code'] });
                    const bmp = await createImageBitmap(file);
                    const codes = await detector.detect(bmp);
                    if (codes && codes.length) {
                        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å QR ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∏‡∏î
                        let best = codes[0];
                        for (const c of codes) {
                            const a = c.boundingBox.width * c.boundingBox.height;
                            const b = best.boundingBox.width * best.boundingBox.height;
                            if (a > b) best = c;
                        }
                        const box = best.boundingBox;
                        const cx = box.x + box.width / 2;
                        const cy = box.y + box.height / 2;
                        const side0 = Math.max(box.width, box.height);
                        const margin = side0 * 0.18; // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                        let side = side0 + margin * 2;
                        side = Math.min(side, Math.min(bmp.width, bmp.height));

                        let sx = cx - side / 2;
                        let sy = cy - side / 2;
                        sx = Math.max(0, Math.min(sx, bmp.width - side));
                        sy = Math.max(0, Math.min(sy, bmp.height - side));

                        const c = document.createElement('canvas');
                        c.width = 512;
                        c.height = 512;
                        const ctx = c.getContext('2d');
                        ctx.drawImage(bmp, sx, sy, side, side, 0, 0, c.width, c.height);
                        outUrl = c.toDataURL('image/png');
                    }
                }
            }catch(err){
                // ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÑ‡∏ß‡πâ: ‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡πá‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏ó‡∏ô
            }

            preview.src = outUrl;
            preview.style.display = 'block';
            placeholder.style.display = 'none';

            // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö QR ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏à‡∏±‡∏ï‡∏∏‡∏£‡∏±‡∏™‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
            requestAnimationFrame(() => syncQrSizeForRow(card));
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 1 ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
        addBankRow();
        window.addEventListener('resize', syncAllQrSizes);
        requestAnimationFrame(syncAllQrSizes);
    

        function updateTotalNumberColor(color){
            const box = document.getElementById('total-box');
            if (!box) return;
            // Apply to container and all descendants so it overrides Tailwind text-* classes
            box.style.color = color;
            box.querySelectorAll('*').forEach(el => { el.style.color = color; });
        }

</script>
</body>
</html>